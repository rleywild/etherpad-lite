# https://github.com/ether/etherpad-lite/wiki/How-to-deploy-Etherpad-Lite-as-a-service
USER=etherpad-lite
SERVICE=epl-live
EPL_DIR=/home/$(USER)/$(SERVICE)
# sysvinit file
SCRIPT_SRC=sysvinit.sh
SCRIPT_DIR=/etc/init.d
SCRIPT_FILE=epl-$(SCRIPT_SRC)
# log file
LOG_DIR=/var/log/$(SERVICE)
LOG_FILE=$(SERVICE).log

all:

sysvinit:
	sudo adduser $(USER)
# log dir
	sudo mkdir $(LOG_DIR)
	sudo chown $(USER) $(LOG_DIR)
	sudo chgrp $(USER) $(LOG_DIR)
# sysvinit file
	cat $(SCRIPT_SRC) | sed \
	-e 's|\(LOGFILE=\)|\1"$(LOG_DIR)/$(LOG_FILE)"|' \
	-e 's|\(EPLITE_DIR=\)|\1"$(EPL_DIR)"|' \
	-e 's|\(USER=\)|\1"$(USER)"|' \
	-e 's|\(GROUP=\)|\1"$(USER)"|' \
	-e 's|\(NAME=\)|\1"$(SERVICE)"|' \
	> $(SCRIPT_DIR)/$(SCRIPT_FILE)
	chmod +x $(SCRIPT_DIR)/$(SCRIPT_FILE)
# start
	update-rc.d $(SCRIPT_FILE) defaults

upstart:
# TODO: tweak upstart.sh to be sed-ed
